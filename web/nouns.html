<html>
<head>
<title>Справочник слов-постов</title>
<meta charset="UTF-8">
<style>

.noun-desc-table {
    border-collapse: collapse;
}
.noun-desc-table td, th {
    vertical-align: top;
    padding-right: 5px;
} 

</style>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

<script src="/js/handlebars-v1.3.0.js"></script>

<script>

function getCurUrlParams() {
    var cur_url = "" + document.URL;
    var url_parts = cur_url.split("?");
    
    var params = {};
    if (url_parts.length > 1) {
        var param_parts = url_parts[1].split("&");
        for(var i =0 ; i< param_parts.length; i++) {
            var p = param_parts[i].split("=");
            params[p[0]] = p[1];
        }
    }
    
    return params;
}

function loadNoun(parse_url_args) {
    var noun ;
    var _date;
    if (parse_url_args) {
        noun = getCurUrlParams()["noun_md5"];
        _date = getCurUrlParams()["date"];
    } else {
        noun = parseInt($("#noun-param").val());
        _date = parseInt($("#date-param").val());
    }
    
    console.log(getCurUrlParams()["id"]);
    $.get( "/api/post_profile?noun_md5=" + noun + "&date=" + _date, function( data ) {
        try{
        var profile = JSON.parse(data);

        profile["date"] = _date;

        var source = $("#noun-template").html();
        var template = Handlebars.compile(source);
 
        $( "#noun-info-holder" ).html( template(profile) );
        } catch (e){
            console.log(e);
        }
    });
}
</script>
</head>
<body onLoad="loadNoun(true)">

<p>
Слово: <input type="text" id="noun-param" value=""/> <br/>
День: <input type="text" id="date-param" value=""/> <br/>
<button type="button" onClick="loadNoun()">Go</button><br/>
</p>
<script id="noun-template" type="text/x-handlebars-template">
<div>
    <h1>{{noun_text}}</h1>
    <h3>Постов с этим словом: {{post_cnt}}</h3>
    <table class="noun-desc-table">
    <tr><th>Частотность слов-ответов</th><th>Несколько твитов с этим словом</th><th>Наиболее похожие слова-посты</th></tr>
    <tr>
    <td>
        <table>
        {{#each reply_profile}}
        <tr><td><a href="/nouns.html?noun_md5={{this.noun_md5}}&date={{../date}}">{{this.noun_text}}</a></td><td>{{this.reply_cnt}}</td>
        {{/each}}
        </table> 
    </td>
    <td>
        <div>
            {{#each tweets}}
            <a href="https://twitter.com/a/status/{{this}}">{{this}}</a><br/>
            {{/each}}
        </div>
    </td>
    <td>
        <table>
        {{#each most_similar_nouns}}
        <tr>
            <td><a href="/nouns.html?noun_md5={{this.noun_md5}}&date={{../date}}">{{this.noun_text}}</a></td>
            <td>{{this.sim}}</td>
            <td>{{this.common_tweet_count}}</td>
        </tr>
        {{/each}}
        </table>
    </td>
    </tr>
    </table>
</div> 
</script>
<div id="noun-info-holder"></div>
</body>
</html>

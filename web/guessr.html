<html>
<head>
<title>О чем говорит twitter</title>
<meta charset="UTF-8">
<style>

.groups-table {
    border-collapse: collapse;
}
td, th {
    border: 2px solid rgb(218,218,218);
    vertical-align: top;
    padding: 5px;
} 
.cluster-container {
    float: left;
    padding-right: 5px;
    
    border: 2px solid rgb(218,218,218);
}
</style>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="/js/handlebars-v1.3.0.js"></script>

<script id="cluster-template" type="text/x-handlebars-template">
<table class="groups-table">
{{#each groups}}
    <tr>
    {{#each this}}
        <td>
        <p>{{avg_dist}}</p>
            {{#each members}}
                <a href="/nouns.html?noun_md5={{this.id}}&date={{../../../date}}">{{this.text}}</a> {{this.post_cnt}}</br>
            {{/each}}
            <p>
            <a href="http://google.com/search?q={{this.query_string}}&tbs=cdr%3A1%2Ccd_min%3A{{../../query_date}}%2Ccd_max%3A{{../../query_date}}">g</a> 
            <a href="http://yandex.ru/yandsearch?text={{this.query_string}}&from_date_full={{../../query_date}}&to_date_full={{../../query_date}}" style="color: red;">Я</a> 
            </p>
        </td>
    {{/each}}
    </tr>
{{/each}}
</table>
</script>
<script>
function clusterToStr(cluster, _date) {
    var mems = cluster["members"];
    var str = "<p>" + cluster["avg_dist"] + "</p>";
    var mems_text = [];
    for(var i=0; i < mems.length; i++) {
        str += "<a href=\"/nouns.html?noun_md5=" + mems[i]["id"] + "&date=" + _date+ "\">" + mems[i]["text"] + "</a></br>";
        mems_text.push(mems[i]["text"]);
    }
    var time_query = "" //"&tbs=cdr%3A1%2Ccd_min%3A14.04.2014%2Ccd_max%3A14.04.2014";
    var google_search = "https://www.google.ru/search?q=" + mems_text.join("+") + time_query;
    str += "<p><a href=\"" + google_search + "\">Искать в google<a/>"; 
    return str;
}
function getCurUrlParams() {
    var cur_url = "" + document.URL;
    var url_parts = cur_url.split("?");
    
    var params = {};
    if (url_parts.length > 1) {
        var param_parts = url_parts[1].split("&");
        for(var i =0 ; i< param_parts.length; i++) {
            var p = param_parts[i].split("=");
            params[p[0]] = p[1];
        }
    }
    
    return params;
}

function parse_query_date(_date) {
    _date = "" + _date;
    return _date.substr(6,2) + '.' + _date.substr(4,2) + '.' + _date.substr(0,4);
}

function update_cur_date(_date) {
    _date = "" + _date;
    var date_str = _date.substr(0,4) + '-' + _date.substr(4,2) + '-' + _date.substr(6,2);
    $("#stat-date").html(date_str);
}

function doGuessr() {
    var title=$("#title-param").val();;
    $.get( "/api/guessr?title=" + title, function( data ) {
        try{
        var profile = JSON.parse(data);
    
        var source = $("#profile-template").html();
        var template = Handlebars.compile(source);

        $( "#guessr-holder" ).html( template(profile) );
        } catch (e){
            console.log(e);
        }
    });
}
</script>

<script id="profile-template" type="text/x-handlebars-template">
    {{#each sim_docs}}
        {{this.title}} <br/>
    {{/each}}
<div id="title-profile" style="display: none">
    {{#each profile}}
    {{this.noun_text}} {{this.sim}}<br/>
    {{/each}}
</div>
</script>
</head>
<body onLoad="">

<p>Спроси: <input type="text" id="title-param" value="" style="width: 300px"/> </p>
<p><button type="button" onClick="doGuessr()">Показать</button></p>

<div id="guessr-holder"></div>
</body>
</html>
